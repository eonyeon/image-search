<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>v17.0 í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .test-panel {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 10px;
            max-width: 600px;
            margin: 0 auto;
        }
        button {
            background: white;
            color: #333;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #f0f0f0;
        }
        .output {
            background: #000;
            color: #0f0;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid #0f0;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            background: rgba(0,0,0,0.5);
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="test-panel">
        <h1>ğŸ” Fashion Search v17.0 í…ŒìŠ¤íŠ¸</h1>
        
        <div class="status">
            <div>ì•± ìƒíƒœ: <span id="app-status">í™•ì¸ ì¤‘...</span></div>
            <div>ë²„ì „: <span id="version">-</span></div>
            <div>DB í¬ê¸°: <span id="db-size">-</span></div>
            <div>íŠ¹ì§• ì°¨ì›: <span id="feature-dim">-</span></div>
        </div>

        <div style="margin: 20px 0;">
            <h3>í…ŒìŠ¤íŠ¸ ë²„íŠ¼</h3>
            <button onclick="checkApp()">ğŸ” ì•± ìƒíƒœ í™•ì¸</button>
            <button onclick="testFeatures()">ğŸ§ª íŠ¹ì§• ì¶”ì¶œ í…ŒìŠ¤íŠ¸</button>
            <button onclick="validateDB()">ğŸ“Š DB ê²€ì¦</button>
            <button onclick="clearDB()">ğŸ’£ ì™„ì „ ì´ˆê¸°í™”</button>
            <button onclick="testImageUpload()">ğŸ“· ì´ë¯¸ì§€ í…ŒìŠ¤íŠ¸</button>
        </div>

        <div class="output" id="output">
            ëŒ€ê¸° ì¤‘...
        </div>
    </div>

    <script type="module">
        // main.js ë¡œë“œ
        import('/src/main.js');
        
        // ì „ì—­ í•¨ìˆ˜
        window.output = function(msg, color = '#0f0') {
            const outputDiv = document.getElementById('output');
            const line = document.createElement('div');
            line.style.color = color;
            line.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            outputDiv.appendChild(line);
            outputDiv.scrollTop = outputDiv.scrollHeight;
        };

        window.checkApp = function() {
            output('=== ì•± ìƒíƒœ í™•ì¸ ===', '#ff0');
            
            if (window.fashionApp) {
                output('âœ… ì•± ë¡œë“œë¨', '#0ff');
                output(`ë²„ì „: ${window.fashionApp.version}`, '#0ff');
                output(`DB í¬ê¸°: ${window.fashionApp.imageDatabase.length}ê°œ`, '#0ff');
                output(`ë””ë²„ê·¸ ëª¨ë“œ: ${window.fashionApp.debugMode}`, '#0ff');
                
                document.getElementById('app-status').textContent = 'âœ… ì •ìƒ';
                document.getElementById('app-status').style.color = '#0f0';
                document.getElementById('version').textContent = window.fashionApp.version;
                document.getElementById('db-size').textContent = window.fashionApp.imageDatabase.length;
            } else {
                output('âŒ ì•±ì´ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤', '#f00');
                document.getElementById('app-status').textContent = 'âŒ ì˜¤ë¥˜';
                document.getElementById('app-status').style.color = '#f00';
            }
        };

        window.testFeatures = async function() {
            output('=== íŠ¹ì§• ì¶”ì¶œ í…ŒìŠ¤íŠ¸ ì‹œì‘ ===', '#ff0');
            
            if (!window.fashionApp) {
                output('âŒ ì•±ì´ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤', '#f00');
                return;
            }
            
            // í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ ìƒì„±
            const canvas = document.createElement('canvas');
            canvas.width = 100;
            canvas.height = 100;
            const ctx = canvas.getContext('2d');
            
            // ê²€ì •ìƒ‰ í…ŒìŠ¤íŠ¸
            ctx.fillStyle = 'black';
            ctx.fillRect(0, 0, 100, 100);
            const blackData = ctx.getImageData(0, 0, 100, 100);
            const blackFeatures = await window.fashionApp.extractHybridFeatures(blackData, canvas);
            
            // ìƒ¤ë„¬ ìŠ¤íƒ€ì¼ í€¼íŒ… íŒ¨í„´
            ctx.fillStyle = 'black';
            ctx.fillRect(0, 0, 100, 100);
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            for (let i = 0; i < 100; i += 20) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, 100);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(0, i);
                ctx.lineTo(100, i);
                ctx.stroke();
            }
            const chanelData = ctx.getImageData(0, 0, 100, 100);
            const chanelFeatures = await window.fashionApp.extractHybridFeatures(chanelData, canvas);
            
            // ë£¨ì´ë¹„í†µ ë¸Œë¼ìš´
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(0, 0, 100, 100);
            const brownData = ctx.getImageData(0, 0, 100, 100);
            const brownFeatures = await window.fashionApp.extractHybridFeatures(brownData, canvas);
            
            output(`ê²€ì •ìƒ‰ íŠ¹ì§•: ${blackFeatures.length}ì°¨ì›`, '#0ff');
            output(`ìƒ¤ë„¬ íŒ¨í„´ íŠ¹ì§•: ${chanelFeatures.length}ì°¨ì›`, '#0ff');
            output(`ë¸Œë¼ìš´ íŠ¹ì§•: ${brownFeatures.length}ì°¨ì›`, '#0ff');
            
            document.getElementById('feature-dim').textContent = `${blackFeatures.length}ì°¨ì›`;
            
            // ìœ ì‚¬ë„ ê³„ì‚°
            const blackVsChanel = window.fashionApp.calculateWeightedSimilarity(blackFeatures, chanelFeatures);
            const blackVsBrown = window.fashionApp.calculateWeightedSimilarity(blackFeatures, brownFeatures);
            const chanelVsBrown = window.fashionApp.calculateWeightedSimilarity(chanelFeatures, brownFeatures);
            
            output('--- ìœ ì‚¬ë„ ê²°ê³¼ ---', '#ff0');
            output(`ê²€ì • vs ìƒ¤ë„¬íŒ¨í„´: ${(blackVsChanel * 100).toFixed(1)}%`, blackVsChanel > 0.8 ? '#f00' : '#0f0');
            output(`ê²€ì • vs ë¸Œë¼ìš´: ${(blackVsBrown * 100).toFixed(1)}%`, blackVsBrown > 0.6 ? '#ff0' : '#0f0');
            output(`ìƒ¤ë„¬íŒ¨í„´ vs ë¸Œë¼ìš´: ${(chanelVsBrown * 100).toFixed(1)}%`, chanelVsBrown > 0.6 ? '#ff0' : '#0f0');
            
            if (blackFeatures.length !== 544) {
                output('âš ï¸ ê²½ê³ : íŠ¹ì§• ì°¨ì›ì´ 544ê°€ ì•„ë‹™ë‹ˆë‹¤!', '#f00');
                output('v17.0ì´ ì œëŒ€ë¡œ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', '#f00');
            } else {
                output('âœ… v17.0 í•˜ì´ë¸Œë¦¬ë“œ ì •ìƒ ì‘ë™!', '#0f0');
            }
        };

        window.validateDB = function() {
            if (!window.fashionApp) {
                output('âŒ ì•±ì´ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤', '#f00');
                return;
            }
            
            output('=== DB ê²€ì¦ ì‹œì‘ ===', '#ff0');
            window.fashionApp.validateDatabase();
            
            // DB í†µê³„
            const db = window.fashionApp.imageDatabase;
            if (db.length > 0) {
                output(`DB í¬ê¸°: ${db.length}ê°œ`, '#0ff');
                output(`ì²« ë²ˆì§¸ ì´ë¯¸ì§€: ${db[0].name}`, '#0ff');
                output(`íŠ¹ì§• ì°¨ì›: ${db[0].features.length}`, '#0ff');
                
                if (db[0].features.length !== 544 && db[0].features.length !== 392) {
                    output('âš ï¸ ë¹„ì •ìƒì ì¸ íŠ¹ì§• ì°¨ì›!', '#f00');
                }
            } else {
                output('DBê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤', '#ff0');
            }
        };

        window.clearDB = async function() {
            if (!window.fashionApp) {
                output('âŒ ì•±ì´ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤', '#f00');
                return;
            }
            
            if (confirm('ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                output('DB ì´ˆê¸°í™” ì¤‘...', '#ff0');
                await window.fashionApp.storage.clear();
                window.fashionApp.imageDatabase = [];
                output('âœ… DB ì´ˆê¸°í™” ì™„ë£Œ', '#0f0');
                
                setTimeout(() => {
                    output('í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨...', '#ff0');
                    location.reload();
                }, 1000);
            }
        };

        window.testImageUpload = function() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (file) {
                    output(`ì´ë¯¸ì§€ ë¡œë“œ: ${file.name}`, '#0ff');
                    
                    const reader = new FileReader();
                    reader.onload = async (event) => {
                        const img = new Image();
                        img.onload = async () => {
                            const canvas = document.createElement('canvas');
                            canvas.width = Math.min(200, img.width);
                            canvas.height = Math.min(200, img.height);
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                            
                            if (window.fashionApp) {
                                const features = await window.fashionApp.extractHybridFeatures(imageData, canvas);
                                output(`íŠ¹ì§• ì¶”ì¶œ ì™„ë£Œ: ${features.length}ì°¨ì›`, '#0f0');
                                document.getElementById('feature-dim').textContent = `${features.length}ì°¨ì›`;
                                
                                if (features.length !== 544) {
                                    output('âš ï¸ ë¹„ì •ìƒì ì¸ ì°¨ì›!', '#f00');
                                }
                            }
                        };
                        img.src = event.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            };
            input.click();
        };

        // ì´ˆê¸° í™•ì¸
        setTimeout(() => {
            checkApp();
        }, 1000);
    </script>
</body>
</html>
