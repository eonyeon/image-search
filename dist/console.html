<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Search Desktop - Console</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1e1e1e;
            color: #fff;
            margin: 0;
            padding: 20px;
        }
        h1 {
            color: #2196F3;
            border-bottom: 2px solid #2196F3;
            padding-bottom: 10px;
        }
        .console-output {
            background: #000;
            border: 1px solid #333;
            border-radius: 5px;
            padding: 15px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
        }
        .console-line {
            margin: 5px 0;
            padding: 3px;
        }
        .console-line.error {
            color: #ff5555;
        }
        .console-line.success {
            color: #50fa7b;
        }
        .console-line.info {
            color: #8be9fd;
        }
        .console-line.warning {
            color: #f1fa8c;
        }
        button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
        }
        button:hover {
            background: #1976D2;
        }
        .button-group {
            margin: 20px 0;
        }
        .status {
            background: #333;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Image Search Desktop - ì§„ë‹¨ ì½˜ì†”</h1>
    
    <div class="status">
        <strong>ìƒíƒœ:</strong> <span id="status">ëŒ€ê¸° ì¤‘...</span>
    </div>

    <div class="button-group">
        <button onclick="runDiagnose()">ğŸ” ì‹œìŠ¤í…œ ì§„ë‹¨</button>
        <button onclick="checkVersion()">ğŸ“Œ ë²„ì „ í™•ì¸</button>
        <button onclick="checkFeatures()">ğŸ“Š íŠ¹ì§• ë²¡í„° í™•ì¸</button>
        <button onclick="testSimilarity()">ğŸ§ª ìœ ì‚¬ë„ í…ŒìŠ¤íŠ¸</button>
        <button onclick="checkMemory()">ğŸ’¾ ë©”ëª¨ë¦¬ ìƒíƒœ</button>
        <button onclick="clearConsole()">ğŸ—‘ï¸ ì½˜ì†” ì§€ìš°ê¸°</button>
    </div>

    <div class="console-output" id="console">
        <div class="console-line info">ì½˜ì†” ì¤€ë¹„ ì™„ë£Œ. ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì§„ë‹¨ì„ ì‹œì‘í•˜ì„¸ìš”.</div>
    </div>

    <div class="button-group">
        <button onclick="clearDB()">âš ï¸ DB ì´ˆê¸°í™”</button>
        <button onclick="goBack()">â†©ï¸ ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
    </div>

    <script>
        const consoleDiv = document.getElementById('console');
        const statusDiv = document.getElementById('status');

        function addConsoleLog(message, type = 'info') {
            const line = document.createElement('div');
            line.className = `console-line ${type}`;
            line.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            consoleDiv.appendChild(line);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        function updateStatus(message) {
            statusDiv.textContent = message;
        }

        // ì „ì—­ ì˜¤ë¥˜ ìºì²˜
        window.addEventListener('error', (event) => {
            addConsoleLog(`ì—ëŸ¬: ${event.message}`, 'error');
        });

        async function runDiagnose() {
            updateStatus('ì§„ë‹¨ ì‹¤í–‰ ì¤‘...');
            addConsoleLog('ğŸ” ì‹œìŠ¤í…œ ì§„ë‹¨ ì‹œì‘...', 'info');
            
            try {
                if (window.parent && window.parent.fashionApp) {
                    const result = await window.parent.fashionApp.diagnose();
                    addConsoleLog(result, 'success');
                } else if (window.fashionApp) {
                    const result = await window.fashionApp.diagnose();
                    addConsoleLog(result, 'success');
                } else {
                    // ì§ì ‘ ì§„ë‹¨
                    addConsoleLog('ì•±ì´ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê¸°ë³¸ ì§„ë‹¨ ì‹¤í–‰...', 'warning');
                    
                    // TensorFlow ì²´í¬
                    if (typeof tf !== 'undefined') {
                        addConsoleLog(`TensorFlow.js: ${tf.version.tfjs}`, 'info');
                        addConsoleLog(`Backend: ${tf.getBackend()}`, 'info');
                    } else {
                        addConsoleLog('TensorFlow.jsê°€ ë¡œë“œë˜ì§€ ì•ŠìŒ', 'error');
                    }
                }
                updateStatus('ì§„ë‹¨ ì™„ë£Œ');
            } catch (error) {
                addConsoleLog(`ì§„ë‹¨ ì‹¤íŒ¨: ${error.message}`, 'error');
                updateStatus('ì§„ë‹¨ ì‹¤íŒ¨');
            }
        }

        async function checkVersion() {
            updateStatus('ë²„ì „ í™•ì¸ ì¤‘...');
            addConsoleLog('ğŸ“Œ ë²„ì „ í™•ì¸...', 'info');
            
            try {
                if (window.parent && window.parent.fashionApp) {
                    const version = window.parent.fashionApp.version();
                    addConsoleLog(`ë²„ì „: ${version}`, 'success');
                } else if (window.fashionApp) {
                    const version = window.fashionApp.version();
                    addConsoleLog(`ë²„ì „: ${version}`, 'success');
                } else {
                    addConsoleLog('ì•± ë²„ì „ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'warning');
                }
                updateStatus('ì™„ë£Œ');
            } catch (error) {
                addConsoleLog(`ë²„ì „ í™•ì¸ ì‹¤íŒ¨: ${error.message}`, 'error');
                updateStatus('ì‹¤íŒ¨');
            }
        }

        async function checkFeatures() {
            updateStatus('íŠ¹ì§• ë²¡í„° í™•ì¸ ì¤‘...');
            addConsoleLog('ğŸ“Š íŠ¹ì§• ë²¡í„° í™•ì¸...', 'info');
            
            try {
                if (window.parent && window.parent.fashionApp) {
                    const features = window.parent.fashionApp.checkFeatures();
                    addConsoleLog(`íŠ¹ì§• ë²¡í„°: ${JSON.stringify(features).substring(0, 200)}...`, 'success');
                } else if (window.fashionApp) {
                    const features = window.fashionApp.checkFeatures();
                    addConsoleLog(`íŠ¹ì§• ë²¡í„°: ${JSON.stringify(features).substring(0, 200)}...`, 'success');
                } else {
                    addConsoleLog('íŠ¹ì§• ë²¡í„°ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'warning');
                }
                updateStatus('ì™„ë£Œ');
            } catch (error) {
                addConsoleLog(`íŠ¹ì§• ë²¡í„° í™•ì¸ ì‹¤íŒ¨: ${error.message}`, 'error');
                updateStatus('ì‹¤íŒ¨');
            }
        }

        async function testSimilarity() {
            updateStatus('ìœ ì‚¬ë„ í…ŒìŠ¤íŠ¸ ì¤‘...');
            addConsoleLog('ğŸ§ª ìœ ì‚¬ë„ í…ŒìŠ¤íŠ¸...', 'info');
            
            try {
                if (window.parent && window.parent.fashionApp) {
                    // ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ ìˆ˜í–‰
                    const db = window.parent.fashionApp.imageDatabase;
                    if (db && db.length >= 2) {
                        const sim = window.parent.fashionApp.calculateCosineSimilarity(
                            db[0].features, 
                            db[1].features
                        );
                        addConsoleLog(`ì´ë¯¸ì§€ 1 vs 2: ${(sim * 100).toFixed(1)}%`, 'info');
                        
                        if (sim > 0.99) {
                            addConsoleLog('âš ï¸ ê²½ê³ : ìœ ì‚¬ë„ê°€ ë¹„ì •ìƒì ìœ¼ë¡œ ë†’ìŠµë‹ˆë‹¤!', 'error');
                        } else {
                            addConsoleLog('âœ… ìœ ì‚¬ë„ê°€ ì •ìƒ ë²”ìœ„ì…ë‹ˆë‹¤', 'success');
                        }
                    } else {
                        addConsoleLog('í…ŒìŠ¤íŠ¸í•  ì´ë¯¸ì§€ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤ (2ê°œ ì´ìƒ í•„ìš”)', 'warning');
                    }
                } else {
                    addConsoleLog('ì•±ì´ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤', 'warning');
                }
                updateStatus('ì™„ë£Œ');
            } catch (error) {
                addConsoleLog(`ìœ ì‚¬ë„ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
                updateStatus('ì‹¤íŒ¨');
            }
        }

        async function checkMemory() {
            updateStatus('ë©”ëª¨ë¦¬ í™•ì¸ ì¤‘...');
            addConsoleLog('ğŸ’¾ ë©”ëª¨ë¦¬ ìƒíƒœ í™•ì¸...', 'info');
            
            try {
                if (typeof tf !== 'undefined') {
                    const memory = tf.memory();
                    addConsoleLog(`Tensors: ${memory.numTensors}`, 'info');
                    addConsoleLog(`Bytes: ${(memory.numBytes / 1048576).toFixed(2)} MB`, 'info');
                }
                
                if (performance.memory) {
                    const used = (performance.memory.usedJSHeapSize / 1048576).toFixed(2);
                    const total = (performance.memory.totalJSHeapSize / 1048576).toFixed(2);
                    addConsoleLog(`JS Heap: ${used} MB / ${total} MB`, 'info');
                }
                updateStatus('ì™„ë£Œ');
            } catch (error) {
                addConsoleLog(`ë©”ëª¨ë¦¬ í™•ì¸ ì‹¤íŒ¨: ${error.message}`, 'error');
                updateStatus('ì‹¤íŒ¨');
            }
        }

        function clearConsole() {
            consoleDiv.innerHTML = '<div class="console-line info">ì½˜ì†”ì´ ì§€ì›Œì¡ŒìŠµë‹ˆë‹¤.</div>';
            updateStatus('ëŒ€ê¸° ì¤‘...');
        }

        async function clearDB() {
            if (confirm('ì •ë§ë¡œ DBë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                updateStatus('DB ì´ˆê¸°í™” ì¤‘...');
                addConsoleLog('âš ï¸ DB ì´ˆê¸°í™” ì‹œì‘...', 'warning');
                
                try {
                    if (window.parent && window.parent.fashionApp) {
                        await window.parent.fashionApp.clearDB();
                        addConsoleLog('âœ… DB ì´ˆê¸°í™” ì™„ë£Œ', 'success');
                    } else {
                        addConsoleLog('ì•±ì´ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤', 'error');
                    }
                    updateStatus('DB ì´ˆê¸°í™” ì™„ë£Œ');
                } catch (error) {
                    addConsoleLog(`DB ì´ˆê¸°í™” ì‹¤íŒ¨: ${error.message}`, 'error');
                    updateStatus('ì‹¤íŒ¨');
                }
            }
        }

        function goBack() {
            window.location.href = 'index.html';
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì§„ë‹¨
        window.addEventListener('load', () => {
            setTimeout(() => {
                addConsoleLog('ìë™ ì§„ë‹¨ì„ ì‹œì‘í•˜ë ¤ë©´ "ì‹œìŠ¤í…œ ì§„ë‹¨" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”', 'info');
            }, 1000);
        });
    </script>
</body>
</html>
