<!DOCTYPE html>
<html>
<head>
    <title>폴더 선택 테스트</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        button {
            padding: 15px 30px;
            font-size: 18px;
            margin: 10px;
            cursor: pointer;
        }
        #log {
            background: #f0f0f0;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>폴더 선택 테스트</h1>
    
    <button onclick="testBasicFile()">1. 단일 파일 선택</button>
    <button onclick="testMultipleFiles()">2. 다중 파일 선택</button>
    <button onclick="testDirectory()">3. 폴더 선택 (webkitdirectory)</button>
    <button onclick="testAlternative()">4. 대체 방법</button>
    
    <div id="log"></div>
    
    <script>
        const log = (msg) => {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            logDiv.textContent += `[${time}] ${msg}\n`;
            console.log(msg);
        };
        
        function testBasicFile() {
            log('=== 단일 파일 선택 테스트 ===');
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            
            input.onchange = (e) => {
                log(`파일 선택됨: ${e.target.files[0].name}`);
                log(`타입: ${e.target.files[0].type}`);
                log(`크기: ${e.target.files[0].size} bytes`);
            };
            
            input.click();
        }
        
        function testMultipleFiles() {
            log('=== 다중 파일 선택 테스트 ===');
            const input = document.createElement('input');
            input.type = 'file';
            input.multiple = true;
            input.accept = 'image/*';
            
            input.onchange = (e) => {
                log(`${e.target.files.length}개 파일 선택됨`);
                for (let file of e.target.files) {
                    log(`  - ${file.name} (${file.type})`);
                }
            };
            
            input.click();
        }
        
        function testDirectory() {
            log('=== 폴더 선택 테스트 (webkitdirectory) ===');
            const input = document.createElement('input');
            input.type = 'file';
            input.webkitdirectory = true;
            input.directory = true;
            
            // 여러 이벤트 리스너 테스트
            input.addEventListener('change', (e) => {
                log(`[addEventListener] 폴더 선택 이벤트 발생`);
                log(`파일 수: ${e.target.files.length}`);
                
                const files = Array.from(e.target.files);
                const images = files.filter(f => 
                    f.type.startsWith('image/') || 
                    f.name.match(/\.(jpg|jpeg|png|gif|webp)$/i)
                );
                
                log(`전체 파일: ${files.length}개`);
                log(`이미지 파일: ${images.length}개`);
                
                // 처음 5개만 표시
                files.slice(0, 5).forEach(f => {
                    log(`  - ${f.name} (${f.type || '타입없음'})`);
                });
                
                if (files.length > 5) {
                    log(`  ... 외 ${files.length - 5}개`);
                }
            });
            
            input.onchange = (e) => {
                log(`[onchange] 이벤트도 발생함`);
            };
            
            log('폴더 선택 다이얼로그 열기...');
            input.click();
        }
        
        function testAlternative() {
            log('=== 대체 방법 테스트 ===');
            const input = document.createElement('input');
            input.type = 'file';
            input.multiple = true;
            
            // webkitdirectory 속성을 동적으로 설정
            input.setAttribute('webkitdirectory', '');
            input.setAttribute('directory', '');
            input.setAttribute('mozdirectory', '');
            
            input.onchange = (e) => {
                log(`파일/폴더 선택됨: ${e.target.files.length}개`);
            };
            
            document.body.appendChild(input);
            setTimeout(() => {
                input.click();
                setTimeout(() => {
                    document.body.removeChild(input);
                }, 100);
            }, 100);
        }
        
        // 브라우저 지원 확인
        window.onload = () => {
            log('=== 브라우저 지원 상태 ===');
            const testInput = document.createElement('input');
            log(`webkitdirectory 지원: ${'webkitdirectory' in testInput}`);
            log(`directory 지원: ${'directory' in testInput}`);
            log(`브라우저: ${navigator.userAgent.split(' ').slice(-2).join(' ')}`);
        };
    </script>
</body>
</html>
